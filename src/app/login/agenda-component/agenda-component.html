<div class="h-screen w-full flex flex-col overflow-hidden">

    <!-- ÁREA DEL GRID - OCUPA TODO EL ESPACIO DISPONIBLE -->
    <div class="flex-2 overflow-auto">
        <div class="h-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 2xl:grid-cols-3 gap-4 p-4">

            <div
                class="2xl:col-span-1 xl:col-span-2 w-full !bg-gray-100 2xl:px-14 xl:px-10 lg:p-10  pt-8 pb-14 rounded-xl shadow-md ">

                @if(flagStepOne){
                <div class="">
                    <h1 class="text-xl titulos font-semibold text-gray-600 mb-8">Agenda tu cita</h1>

                    <!-- Step 1 -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-sm font-semibold text-gray-900">Elige cuándo quieres tu cita</h3>

                                <p class="text-sm text-gray-600 pt-1">
                                    Selecciona el servicio o especialidad y cuándo quieres ser atendido.
                                </p>
                            </div>
                            <div class="pt-1">
                                <svg class="" width="60" height="60" viewBox="-18.75 -18.75 187.5 187.5" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg" style="transform:rotate(-90deg); float: right;">
                                    <circle r="65" cx="75" cy="75" fill="transparent" stroke="#ffffff"
                                        stroke-width="15"></circle>
                                    <circle r="65" cx="75" cy="75" stroke="#0ebeb2" stroke-width="15"
                                        stroke-linecap="round" stroke-dashoffset="273px" fill="transparent"
                                        stroke-dasharray="408.2px"></circle>
                                    <text x="44px" y="85px" fill="#0ebeb2" font-size="40px" font-weight="bold"
                                        style="transform:rotate(90deg) translate(0px, -146px)">1/3</text>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- VISTA 2xl -->
                    <div class=" px-2 2xl:h-[38rem] 2xl:block xl:hidden lg:hidden md:hidden sm:hidden  "
                        [ngClass]="{'overflowClass': flagClassOverflow, 'scrollbar-hide':flagClassOverflow}">
                        <div class="space-y-6  ">
                            <!-- Servicio o Especialidad -->
                            <div>
                                <label for="servicio" class="block text-sm font-medium text-gray-600 ">
                                    Servicio o Especialidad *
                                </label>
                                <select class="inputGeneral4">
                                    <option selected>Medicina general</option>
                                    <option value="cardiologia">Cardiología</option>
                                    <option value="dermatologia">Dermatología</option>
                                    <option value="pediatria">Pediatría</option>
                                    <option value="ginecologia">Ginecología</option>
                                </select>
                            </div>

                            <!-- Profesional / Técnico -->
                            <div>
                                <label for="profesional" class="block text-sm font-medium text-gray-600">
                                    Profesional / Técnico *
                                </label>
                                <select class="inputGeneral4">
                                    <option selected>Dr. Luis Moreno</option>
                                    <option value="dra-garcia">Dra. María García</option>
                                    <option value="dr-rodriguez">Dr. Carlos Rodríguez</option>
                                    <option value="dra-lopez">Dra. Ana López</option>
                                </select>
                            </div>

                            <!-- Calendario -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 my-5">
                                    Selecciona una fecha y hora
                                </label>

                                <!-- Calendar Header -->
                                <div class="!w-full h-[22rem] bg-white flex justify-center py-5">
                                    <app-calendar (dateSelect)="detectDate($event)"></app-calendar>
                                </div>

                            </div>

                            <div class="mt-5">
                                @if(flagClassOverflow){
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Selecciona un horario disponible
                                </label>
                                <div class="grid grid-cols-3 gap-2">
                                    @for(h of horarios; track h.id){
                                    <div class="col-span-1">
                                        <button (click)="selectSchedule(h)" [class]="getButtonClasses(h.id)"
                                            class="cursor-pointer w-full rounded-lg py-3.5 text-xs transition-all duration-200">
                                            {{h.horaI}} - {{h.horaF}}
                                        </button>
                                    </div>
                                    }
                                </div>
                                }
                            </div>

                            <!-- Siguiente Button -->
                            <div class="flex justify-end" #Horarios>
                                <button (click)="nextStepTwo()" [disabled]="!selectedScheduleId" class="font-medium py-1.5 px-4 rounded-full text-sm transition duration-200
                                        {{selectedScheduleId 
                                        ? 'bg-red-500 text-white shadow-lg hover:bg-red-600 cursor-pointer' 
                                        : 'bg-gray-200 text-gray-500 cursor-not-allowed'}}">
                                    Siguiente
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Vista XL -->
                    <div
                        class=" px-2 xl:h-[48vh] !lg:[30vh]  2xl:hidden xl:block lg:block md:hidden sm:hidden  overflow-y-scroll scrollbar-hide: ">
                        <div class="space-y-5  ">
                            <!-- Servicio o Especialidad -->
                            <div>
                                <label for="servicio" class="block text-sm font-medium text-gray-600 ">
                                    Servicio o Especialidad *
                                </label>
                                <select class="inputGeneral4">
                                    <option selected>Medicina general</option>
                                    <option value="cardiologia">Cardiología</option>
                                    <option value="dermatologia">Dermatología</option>
                                    <option value="pediatria">Pediatría</option>
                                    <option value="ginecologia">Ginecología</option>
                                </select>
                            </div>

                            <!-- Profesional / Técnico -->
                            <div>
                                <label for="profesional" class="block text-sm font-medium text-gray-600">
                                    Profesional / Técnico *
                                </label>
                                <select class="inputGeneral4">
                                    <option selected>Dr. Luis Moreno</option>
                                    <option value="dra-garcia">Dra. María García</option>
                                    <option value="dr-rodriguez">Dr. Carlos Rodríguez</option>
                                    <option value="dra-lopez">Dra. Ana López</option>
                                </select>
                            </div>

                            <!-- Calendario -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700  mb-1">
                                    Selecciona una fecha y hora
                                </label>

                                <!-- Calendar Header -->
                                <div class="!w-full bg-white flex justify-center p-5">
                                    <app-calendar (dateSelect)="detectDate($event)"></app-calendar>
                                </div>

                            </div>

                            <div #Horarios>
                                @if(flagClassOverflow){
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Selecciona un horario disponible
                                </label>
                                <div class="grid grid-cols-3 space-y-2 ">
                                    @for(h of horarios; track h.id){
                                    <div class="col-span-1 mr-2">
                                        <button
                                            class="bg-transparent hover:bg-white hover:shadow-md border border-gray-300 w-full rounded-lg py-3 text-xs ">
                                            {{h.horaI}}-{{h.horaF}}
                                        </button>
                                    </div>
                                    }
                                </div>
                                }
                            </div>


                            <!-- Siguiente Button -->
                            <div class="flex justify-end">
                                <button (click)="nextStepTwo()"
                                    class="bg-gray-200  text-gray-500  font-medium py-1.5 px-4 rounded-full text-xs transition duration-200">
                                    Siguiente
                                </button>
                            </div>

                        </div>
                    </div>


                </div>
                }@else if(flagStepTwo){
                <div class="">
                    <h1 class="text-xl titulos font-semibold text-gray-600 mb-8"><i
                            class="ri-arrow-left-line cursor-pointer " (click)="backStepOne()"></i> Agenda tu cita
                    </h1>

                    <!-- Step 2 -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-sm font-semibold text-gray-900">¿Quién agenda esta cita?</h3>

                                <p class="text-sm text-gray-600 pt-1">
                                    Completa tus datos para que podamos confirmar tu cita y enviarte una
                                    notificación.
                                </p>
                            </div>
                            <div class="pt-1">
                                <svg class="justify-end  " width="60" height="60" viewBox="-18.75 -18.75 187.5 187.5"
                                    version="1.1" xmlns="http://www.w3.org/2000/svg"
                                    style="transform:rotate(-90deg); float: right;">
                                    <circle r="65" cx="75" cy="75" fill="transparent" stroke="#ffffff"
                                        stroke-width="15"></circle>
                                    <circle r="65" cx="75" cy="75" stroke="#0ebeb2" stroke-width="15"
                                        stroke-linecap="round" stroke-dashoffset="139px" fill="transparent"
                                        stroke-dasharray="408.2px"></circle>
                                    <text x="44px" y="85px" fill="#0ebeb2" font-size="40px" font-weight="bold"
                                        style="transform:rotate(90deg) translate(0px, -146px)">2/3</text>
                                </svg>
                            </div>
                        </div>
                    </div>


                    <div class="space-y-6">
                        <!-- Cédula -->
                        <div>
                            <label for="servicio" class="block text-sm font-medium text-gray-600 ">
                                Cédula *
                            </label>
                            <input type="text" class="inputGeneral4" placeholder="Ej: 1100048520">
                        </div>

                        <!-- Nombres -->
                        <div>
                            <label for="profesional" class="block text-sm font-medium text-gray-600">
                                Nombres *
                            </label>
                            <input type="text" class="inputGeneral4" placeholder="Ej: Ana María">
                        </div>
                        <!-- Apellidos -->
                        <div>
                            <label for="profesional" class="block text-sm font-medium text-gray-600">
                                Apellidos *
                            </label>
                            <input type="text" class="inputGeneral4" placeholder="Ej: Torres Torres">
                        </div>
                        <!-- Correo -->
                        <div>
                            <label for="profesional" class="block text-sm font-medium text-gray-600">
                                Correo electrónico *
                            </label>
                            <input type="email" class="inputGeneral4" placeholder="Ej: ana.torres@email.com">
                        </div>
                        <!-- Teléfono -->
                        <div>
                            <label for="profesional" class="block text-sm font-medium text-gray-600">
                                Teléfono *
                            </label>
                            <!-- <input type="phone" class="inputGeneral"> -->

                            <div (click)="closeDropdown()">
                                <form (click)="stopPropagation($event)">
                                    <div class="flex">
                                        <div class="relative">
                                            <button type="button" (click)="toggleDropdown(); stopPropagation($event)"
                                                class="flex-shrink-0 z-10 inline-flex items-center justify-between py-1.5 px-3 text-sm font-medium text-center text-gray-900 bg-gray-100 border border-e-0 border-gray-300 rounded-s-lg hover:bg-gray-200 min-w-fit">

                                                <!-- Contenedor para imagen y código -->
                                                <div class="flex items-center space-x-2">
                                                    <span class="w-5 h-5 rounded-full">
                                                        <img [src]="selectedCategory.image"
                                                            class=" object-cover flex-shrink-0"
                                                            [alt]="selectedCategory.nameES">
                                                    </span>
                                                    <span
                                                        class="whitespace-nowrap !text-gray-500">+{{selectedCategory.phoneCode}}</span>
                                                </div>

                                                <!-- SVG flecha siempre visible -->
                                                <svg class="w-2.5 h-2.5 ml-2 flex-shrink-0 !text-gray-500" fill="none"
                                                    stroke="currentColor" viewBox="0 0 10 6">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="m1 1 4 4 4-4" />
                                                </svg>
                                            </button>

                                            <div *ngIf="dropdownOpen" (click)="stopPropagation($event)"
                                                class="absolute left-0 top-full mt-1 z-50 bg-white divide-y divide-gray-100 rounded-lg shadow w-56 h-72 overflow-hidden">

                                                <!-- Campo de búsqueda -->
                                                <div class="p-3 border-b border-gray-100">
                                                    <input type="text" (keyup)="searchCountry($event)"
                                                        placeholder="Buscar país..."
                                                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                </div>

                                                <!-- Lista con scroll -->
                                                <div class="h-full overflow-y-auto">
                                                    <ul class="py-2 text-sm text-gray-700">
                                                        @for(c of countries; track c){
                                                        <li>
                                                            <button type="button" (click)="selectCategory(c)"
                                                                class="inline-flex w-full px-4 py-2 text-left hover:bg-gray-100 items-center gap-3">
                                                                <img [src]="c.image"
                                                                    class="w-5 h-5 rounded-full object-cover flex-shrink-0"
                                                                    [alt]="c.nameES">
                                                                <div>
                                                                    <div class="font-medium">{{ c.nameES || c.name }}
                                                                    </div>
                                                                    <div class="text-xs text-gray-500">+{{ c.phoneCode
                                                                        }}</div>
                                                                </div>
                                                            </button>
                                                        </li>
                                                        }
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="relative w-full">
                                            <input type="search" [placeholder]="" class="inputPhone"
                                                placeholder="0991XXXXXX" required />
                                        </div>
                                    </div>
                                </form>
                            </div>



                        </div>



                        <!-- Siguiente Button -->
                        <div class="flex justify-end">
                            <button (click)="nextStepThree()"
                                class="bg-gray-200  text-gray-500  font-medium py-1.5 px-4 rounded-full text-xs transition duration-200">
                                Siguiente
                            </button>
                        </div>

                    </div>
                </div>
                }@else if(flagStepThree) {
                <div class="">
                    <h1 class="text-xl titulos font-semibold text-gray-600 mb-8"><i
                            class="ri-arrow-left-line cursor-pointer " (click)="backStepTwo()"></i> Agenda tu cita
                    </h1>

                    <div class="mb-6">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-sm font-semibold text-gray-900">Revisa tu cita antes de confirmar
                                </h3>

                                <p class="text-sm text-gray-600 pt-1">
                                    Verifica que los datos sean correctos antes de finalizar. Recibirás una
                                    notificación
                                    por correo o WhatsApp con la información de tu cita.
                                </p>
                            </div>
                            <div class="pt-1">
                                <svg width="60" height="60" viewBox="-18.75 -18.75 187.5 187.5" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg" style="transform:rotate(-90deg)">
                                    <circle r="65" cx="75" cy="75" fill="transparent" stroke="#ffffff"
                                        stroke-width="15"></circle>
                                    <circle r="65" cx="75" cy="75" stroke="#0ebeb2" stroke-width="15"
                                        stroke-linecap="round" stroke-dashoffset="0px" fill="transparent"
                                        stroke-dasharray="408.2px"></circle>
                                    <text x="44px" y="85px" fill="#0ebeb2" font-size="40px" font-weight="bold"
                                        style="transform:rotate(90deg) translate(0px, -146px)">3/3</text>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- Servicio o Especialidad -->
                        <div>
                            <label for="servicio" class="block text-sm font-medium text-gray-600 ">
                                Servicio o Especialidad *
                            </label>
                            <select class="inputGeneral">
                                <option selected>Medicina general</option>
                                <option value="cardiologia">Cardiología</option>
                                <option value="dermatologia">Dermatología</option>
                                <option value="pediatria">Pediatría</option>
                                <option value="ginecologia">Ginecología</option>
                            </select>
                        </div>

                        <!-- Profesional / Técnico -->
                        <div>
                            <label for="profesional" class="block text-sm font-medium text-gray-600">
                                Profesional / Técnico *
                            </label>
                            <select id="profesional" class="inputGeneral">
                                <option selected>Dr. Luis Moreno</option>
                                <option value="dra-garcia">Dra. María García</option>
                                <option value="dr-rodriguez">Dr. Carlos Rodríguez</option>
                                <option value="dra-lopez">Dra. Ana López</option>
                            </select>
                        </div>

                        <!-- Calendario -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700  pt-5 mb-2">
                                Selecciona una fecha y hora
                            </label>

                            <!-- Calendar Header -->
                            <div class="bg-white border border-gray-300 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <button type="button" class="p-1 hover:bg-gray-100 rounded">
                                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 19l-7-7 7-7"></path>
                                        </svg>
                                    </button>
                                    <h3 class="text-lg font-semibold text-gray-900">Julio 2025</h3>
                                    <button type="button" class="p-1 hover:bg-gray-100 rounded">
                                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                </div>

                                <!-- Calendar Grid -->

                            </div>
                        </div>

                        <!-- Siguiente Button -->
                        <div class="flex justify-end">
                            <button
                                class="bg-gray-200  text-gray-500  font-medium py-1.5 px-4 rounded-full text-xs transition duration-200">
                                Siguiente
                            </button>
                        </div>

                    </div>
                </div>
                }

            </div>

            <div class="2xl:col-span-2 xl:col-span-3 rounded-xl backgroundInit relative">
                <form class="space-y-6">
                    <div class="text-3xl text-white titulos absolute bottom-0 right-0 mb-24 mr-10 ">
                        <h1 class="flex justify-end">Reserva de forma segura, rapida y sin</h1>
                        <h1 class="flex justify-end">complicaciones.</h1>
                    </div>
                    <span (click)="goToPage()"
                        class="absolute hover:cursor-pointer hover:text-gray-400  top-0 right-0  text-gray-400 m-5 glass"
                        style="padding: 2px 15px;">
                        Iniciar Sesión
                    </span>
                    <img class="absolute top-0 left-0 p-5" src="/assets/img/agenda_Logo_Horizontal.png" alt="">
                </form>
            </div>
        </div>
    </div>

    <!-- FOOTER FIJO EN LA PARTE INFERIOR -->
    <footer class="bg-gray-100 text-white py-4 px-6 flex-shrink-0 shadow-lg">
        <div class="flex flex-col sm:flex-row justify-between items-center space-y-2 sm:space-y-0">
            <!-- Información de copyright -->
            <div class="text-sm text-gray-700">
                © {{ currentYear }} Powered by Punto Pymes
            </div>

            <!-- Enlaces del footer -->
            <div class="flex flex-wrap justify-center gap-4 text-sm">
                <a *ngFor="let link of footerLinks" [href]="link.url"
                    class="text-gray-700 hover:text-white transition-colors duration-200">
                    {{ link.text }}
                </a>
            </div>

            <!-- Versión -->
            <div class="text-sm text-gray-700">
                Versión {{ appVersion }}
            </div>
        </div>
    </footer>

</div>